---
layout:     post
title:      docker基础概念学习
date:       2019-04-22 12:16:00
summary:    docker
categories: jekyll pixyll
---

> docker run = docker create + start docker在后台运行的标准操作：
1. 检查本地是否存在指定的镜像Image，不存在就从公有仓库下载
2. 利用镜像创建一个容器，并启动该容器
3. 分配一个文件系统给容器，并在只读的镜像层外面挂载一层可读写层
4. 从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去
5. 从网桥的地址池配置一个IP地址给容器
6. 执行用户指定的应用程序
7. 执行完毕后容器自动终止

docker run -it ubuntu:18.04 /bin/bash
-t 选项是为了分配一个伪终端
-i 让容器的标准输入保持打开
-t 在后台以守护(Daemonized)形式运行，此时可以添加-d参数来实现



### docker数据管理
需求： 数据持久化以及多个容器之间进行数据共享
容器中管理数据主要有两种方式：
1. 数据卷(data Volumes): 容器内数据直接映射到本地主机环境；
2. 数据卷容器(data Volume Container): 使用特定容器维护数据卷

主要内容：
- 在容器中创建数据卷，并把本地的目录或摁键挂载道容器内的数据卷中。
-

### 端口映射与容器互联
需求： 多个服务组件容器共同协作的请客，需要多个容器之间能够相互访问到对方的服务
features:
1. 映射容器内应用的服务端口到本地宿主主机
2. 多个容器间通过容器名来快速访问

#### 端口映射实现容器访问
在启动容器时，如果不指定对应的参数，在容器外部是无法通过网络来访问容器内部的网络应用以及服务，可以使用-P来指定端口映射，Docker会随机映射一个49000~49900的端口到内部容器开放的网络端口：
  docker run -d -P training/webapp python app.py
  docker ps -l
此时可以看到本地主机的49155被映射到了容器的5000端口，访问宿主主机的49155端口即可访问容器内web应用提供的界面，且在一个指定端口上只可以绑定一个容器。

#### 端口的互联
> 容器的互联是一种让多个容器中的应用进行快速交互的方式，它会在源和接收容器之间创建连接关系，接收容器可以快速访问到源容器，而不用指定具体的IP地址。

docker相当于在两个互联的容器之间创建了一个虚拟通道，而且不用映射他们的端口到宿主主机上，在启动db容器的时候并没有使用-p标记，避免了暴露数据库服务端口外部网络上。在生产环境中，网络方面的需求更加复杂，包括跨主机甚至是跨数据中心的通信，这时候往往需要引入额zho外的机制，例如SDN（软件定义网络哟）或者 NFV（网络功能虚拟化）的相关技术。其中 libnetwork可以实现跨主机的容器通信，以及Docker网络的高级功能和配置。

#### 使用Dockerfile创建镜像
> dockerfile 是一个文本格式的配置文件，用户可以使用dockerfile来快速创建自定义的镜像，涉及Dockerfile的基本结构以及支持的指令

Dockerfile主体内容由四部分组成：基础镜像信息、维护者信息、镜像操作指令、容器启动时执行指令。
