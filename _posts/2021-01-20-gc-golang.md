---
layout:     post
title:      gc of golang.
date:       2021-01-20 12:16:00
summary:    golang
categories: jekyll pixyll
---


## Mark Setup -STW
> When a collection starts, the first activity that must be performed is turning on the Write Barrier. write barrier: allow the collector to maintain data integrity on the heap during a colleciton since both the collector and application goroutines will be concurrently.

1. key point.
 - in order to turn the write barrier on, every application goroutine running must be stopped. This activity is usually very quick. within 10 to 30 microseconds on average.

#### e.g: 
  if one goroutine could run for an unreasonable amount of time with no opportunity to be stopped. this is the kind of code that could stall a collection from starting.
  what's worse is the other P's can't service any other goroutines while the collector waits.It's critically import that goroutine make function calls in reasonable timeframes.
  
proposal:
  this is something the language team is looking to correct in 1.14 by adding preemptive techniques to the scheduler[https://github.com/golang/go/issues/24543].
  
## Marking -Concurrent.

> once the write Barrier is turned on, the collector commences with the Marking phase. 
 1. the collector does is take 25% of the available CPU capacity for itself. the collector uses Goroutines to do the collection work and needs the same P's and M's the application Goroutines use. 
      this means for our 4 threaded Ho program, one entire P will be dedicated to collection work.
